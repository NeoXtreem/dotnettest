# Schnoodle DApp
Schnoodle X is a DApp to allow interaction with the Schnoodle smart contracts via a web browser interface.

# Prerequisites
- [Node.js](https://nodejs.org/)
- [Visual Studio 2022 Preview](https://visualstudio.microsoft.com/vs/preview/)
- [Visual Studio Code](https://code.visualstudio.com/)
- [Solidity extension](https://marketplace.visualstudio.com/items?itemName=JuanBlanco.solidity)
- Local blockchain (use [Truffle Develop](https://www.trufflesuite.com/docs/truffle/getting-started/using-truffle-develop-and-the-console#truffle-develop) or [Ganache](https://www.trufflesuite.com/ganache))

Additionally, the following shared services steps should be completed **only once** per environment for the product:
1. Create an Azure Cosmos DB account with SQL API [here](https://azure.microsoft.com/en-gb/try/cosmosdb).
    - Production: `schnoodle`
    - Test: `schnoodle-test`
1. Create an Azure storage account [here](https://docs.microsoft.com/en-us/azure/storage/common/storage-account-create).
    - Production: `stschnoodle`
    - Test: `stschnoodletest`

# Blockchain
Execute the following commands in a `truffle develop` console in the root folder of the repo:
1. `migrate` (add `--compile-none` if contracts haven't changed since the last compile)
1. `exec scripts/initialize.js`

# Client
## Setup
1. Execute `npm i` in the **ClientApp** folder.
1. Populate the **secrets.json** (see [here](#secrets)) file then execute `type .\secrets.json | dotnet user-secrets set`.
1. If any Solidity files matching the ABI files listed in **Nethereum.Generator.json** have changed since the C# classes in the **Contracts** folder were last autogenerated, follow these steps:
    1. Open the root folder if the repo in Visual Studio Code.
    1. Open each changed Solidity file (**\contracts** folder) and press F5 ('Solidity: Compile Contract' command).

## Run
1. Open **Schnoodle.sln** in Visual Studio 2022.
1. Build and run.
1. Connect MetaMask to local network (e.g., http://localhost:7545). You will need to reset MetaMask (in advanced settings) if the network was restarted since the previous run.
1. Add the first account private key in Truffle Develop to MetaMask, and select this account.

> 📘 Info
>
> For faster builds, if all autogenerated code is up to date, change `NethereumGenerateCode` in **SchnoodleDApp.csproj** to `false`. Do not commit this change to source control.

### Secrets
1. For `Pinata:Jwt`, open a [Pinata](https://app.pinata.cloud) account then create an API key.
1. For `Blockchain:PrivateKey`, use any Ethereum account that has some test ETH. Ensure this account has the `MINTER_ROLE` on the smart contract using `hasRole`. If not, the contract owner must grant it using `grantRole`.
1. For `Data:Key`, obtain the read-write primary key for the test Azure Cosmos DB account from the administrator of that account.
1. For `Files:Key`, obtain one of the access keys for the test Azure storage account from the administrator of that account.